<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.324">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Anurag Patil">

<title>Predicting customer behaviour using scikit learn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="main_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="main_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="main_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_analysis_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#scenario" id="toc-scenario" class="nav-link active" data-scroll-target="#scenario">1. Scenario</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">2. Data</a></li>
  <li><a href="#defining-the-problem" id="toc-defining-the-problem" class="nav-link" data-scroll-target="#defining-the-problem">3. Defining the problem</a></li>
  <li><a href="#data-cleaning-and-validation." id="toc-data-cleaning-and-validation." class="nav-link" data-scroll-target="#data-cleaning-and-validation.">4. Data cleaning and validation.</a></li>
  <li><a href="#visual-inspection" id="toc-visual-inspection" class="nav-link" data-scroll-target="#visual-inspection">5. Visual inspection</a></li>
  <li><a href="#preprocessing-and-building-pipeline." id="toc-preprocessing-and-building-pipeline." class="nav-link" data-scroll-target="#preprocessing-and-building-pipeline.">6. Preprocessing and Building Pipeline.</a></li>
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning">7. Hyperparameter Tuning</a></li>
  <li><a href="#final-training." id="toc-final-training." class="nav-link" data-scroll-target="#final-training.">8. Final Training.</a></li>
  <li><a href="#final-thougts" id="toc-final-thougts" class="nav-link" data-scroll-target="#final-thougts">9. Final Thougts</a></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Predicting customer behaviour using scikit learn</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Anurag Patil </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><br></p>
<section id="before-getting-into-the-report" class="level4">
<h4 class="anchored" data-anchor-id="before-getting-into-the-report">Before getting into the report</h4>
<ol type="1">
<li>All the code cells are collapsed so the reader can focus on the analysis</li>
<li>Although if you are interested in looking at the code at certain part you can unfold the code block just by clicking on the <strong>“Code”</strong> button provided.</li>
<li>If you are interested in looking at all the code you can unfold all the code cells at once by using the option in right hand corner. Alternatively you can go to the github repositery where all the code for this is hosted. <a href="https://github.com/ANP-Oxy/GoalZone">repositery</a></li>
</ol>
<hr>
<ul>
<li>This is a revamped version of the original case study that I worked on for DataCamp’s <strong>“Data Scientist Associate certification”.</strong></li>
<li>The dataset as well as the problem scenario was provided by DataCamp.</li>
<li>In this report I will be working on a fictitious business scenario, dealing with a customer behaviour classification problem.</li>
<li>I will clean the data, validate it, do some visual insepction of the data and then work on modelling it.</li>
<li>The tools used for this analysis are python, numpy, pandas, matplotlib, seaborn, scikit-learn, imbalanced learn and the report was generated using Quarto.</li>
</ul>
</section>
<section id="scenario" class="level2">
<h2 class="anchored" data-anchor-id="scenario">1. Scenario</h2>
<ul>
<li>GoalZone is a fitness club chain in Canada.</li>
<li>GoalZone offers a range of fitness classes in two capacities - 25 and 15.</li>
<li>Some classes are always fully booked. Fully booked classes often have a low attendance rate.</li>
<li>GoalZone wants to increase the number of spaces available for classes.</li>
<li>They want to do this by predicting whether the member will attend the class or not.</li>
<li>If they can predict a member will not attend the class, they can make another space available.</li>
</ul>
<hr>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">2. Data</h2>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing the necessary modules</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># let's get the data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://s3.amazonaws.com/talent-assets.datacamp.com/fitness_class_2212.csv"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># this will fetch the data and put it into a dataframe. </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Anurag\AppData\Local\Temp\ipykernel_5904\1184041087.py:6: MatplotlibDeprecationWarning: The seaborn styles shipped by Matplotlib are deprecated since 3.6, as they no longer correspond to the styles shipped by seaborn. However, they will remain available as 'seaborn-v0_8-&lt;style&gt;'. Alternatively, directly use the seaborn API instead.
  plt.style.use("seaborn")</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="163">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">booking_id</th>
<th data-quarto-table-cell-role="th">months_as_member</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">days_before</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">attended</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>17</td>
<td>79.56</td>
<td>8</td>
<td>Wed</td>
<td>PM</td>
<td>Strength</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>10</td>
<td>79.01</td>
<td>2</td>
<td>Mon</td>
<td>AM</td>
<td>HIIT</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>16</td>
<td>74.53</td>
<td>14</td>
<td>Sun</td>
<td>AM</td>
<td>Strength</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>5</td>
<td>86.12</td>
<td>10</td>
<td>Fri</td>
<td>AM</td>
<td>Cycling</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>15</td>
<td>69.29</td>
<td>8</td>
<td>Thu</td>
<td>AM</td>
<td>HIIT</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>The data has 8 columns and 1500 rows</strong><br> The basic descriptions of the columns are.<br></p>
<ol type="1">
<li>unique booking id</li>
<li>The number of months as this fitness club member</li>
<li>weight</li>
<li>The number of days before the class the member registered</li>
<li>day of week of the class</li>
<li>time of class</li>
<li>category</li>
<li>The last column attended shows whether the member attended the class or not with 0 corresponding to “No” and 1 to “Yes”.</li>
</ol>
</section>
<section id="defining-the-problem" class="level2">
<h2 class="anchored" data-anchor-id="defining-the-problem">3. Defining the problem</h2>
<ul>
<li><strong>The business wants to predict whether members will attend using the data provided</strong></li>
<li>Here even though the specific task about predicting whether the member will attend the class or not we should keep in mind that the end goal to increase the number of members joining the class.</li>
<li>Keeping the big picture in the back of the mind before diving into analysis is necessary.</li>
<li>Now, about the data since our target variable is binary this is essentially a <strong>Binary Classification</strong> problem</li>
<li>We have to predict whether the member who has registered for the class will attend the class or not.</li>
</ul>
<p>Now that we have taken a glimpse of the data, decided what our end goal is let’s get into the actual analysis. we will go through this step by step by first validating the data then doing some Exploratory analysis and finally training some machine learning models.</p>
</section>
<section id="data-cleaning-and-validation." class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-and-validation.">4. Data cleaning and validation.</h2>
<p><br> Let’s take a look at some information about the columns</p>
<ol type="1">
<li>“months_as_member” : 1 is minimum value for this column</li>
<li>“weight” : 40.00 is minimum value</li>
<li>“days_before” : 1 is minimum value</li>
<li>“day_of_week” : “Mon”, “Tue”, “Wed”, “Thu”, “Fri”, “Sat”, “Sun” are valid values</li>
<li>“time” : “AM” , “PM” are valid values</li>
<li>“category” : “Yoga”, “Aqua” , “Strength”, “HIIT”, “Cycling”, “unknown” are valid values</li>
<li>“attended” : 1, 0 are valid values</li>
</ol>
<p>Below I’m creating a python dictionary that contains some metadata about the data we have. This will be used later on to validate the integrity of the data.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_dict <span class="op">=</span> {<span class="st">"booking_id"</span>  : <span class="st">"The unique identifier of the booking."</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">"months_as_member"</span> : <span class="dv">1</span>, <span class="co"># minimum value for this column</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"weight"</span> : <span class="fl">40.00</span>, <span class="co"># minimum value</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"days_before"</span> : <span class="dv">1</span>, <span class="co"># minimum value</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"day_of_week"</span> : [<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>], <span class="co"># valid categories</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"time"</span> : [<span class="st">"AM"</span> , <span class="st">"PM"</span>], <span class="co"># valid categories</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"category"</span> : [<span class="st">"Yoga"</span>, <span class="st">"Aqua"</span> , <span class="st">"Strength"</span>, <span class="st">"HIIT"</span>, <span class="st">"Cycling"</span>, <span class="st">"unknown"</span>], <span class="co"># valid categories</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"attended"</span> : [<span class="dv">1</span>, <span class="dv">0</span>] <span class="co"># valid categories</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="lets-take-a-look-at-what-kind-of-problems-the-data-has." class="level4">
<h4 class="anchored" data-anchor-id="lets-take-a-look-at-what-kind-of-problems-the-data-has.">Let’s take a look at what kind of problems the data has. <br></h4>
<p>first we will check the categorical columns</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the categorical columns</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Print value counts for each of those columns</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> data.select_dtypes(<span class="st">"object"</span>).columns:        </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> :</span><span class="ch">\n</span><span class="sc">{</span>data[column]<span class="sc">.</span>value_counts()<span class="sc">}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>I have disabled the output here because it is very long but you can execute the code and take a look at it</strong><br> <strong>The problems identified in the categorical columns are</strong></p>
<ol type="1">
<li>The days before column is not completely numeric and some cells have “days” string written alongside the number of days. This is data entry incosistency and needs to be fixed.</li>
<li>The day of the week also has data entry errors and the weekday names aren’t consistent.</li>
<li>The time columns seems fine</li>
<li>category column has “-” as values in few columns which will need to be replaced.</li>
</ol>
<p><strong>I will peform series of operations on the data and fix the problems mentioned above.</strong></p>
<ol type="1">
<li>first we fix the days before column by elimination string characters from it</li>
<li>next we fixed the day_of_week column by using the function defind above</li>
<li>then fix the category column by replacing “-” with “unknown”</li>
<li>after that we change the datatypes of the columns</li>
<li>lastly drop the “booking_id” column as it is not useful</li>
</ol>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a function to fix the day_of_week column</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fix_dow(df):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day_of_week'</span>] <span class="op">=</span> df[<span class="st">'day_of_week'</span>].<span class="bu">str</span>.replace(<span class="st">'Fri.'</span>, <span class="st">"Fri"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day_of_week'</span>] <span class="op">=</span> df[<span class="st">'day_of_week'</span>].<span class="bu">str</span>.replace(<span class="st">'Monday'</span>, <span class="st">"Mon"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day_of_week'</span>] <span class="op">=</span> df[<span class="st">'day_of_week'</span>].<span class="bu">str</span>.replace(<span class="st">'Wednesday'</span>, <span class="st">"Wed"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[<span class="st">'day_of_week'</span>]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># this fuction will carry out cleaning steps outlined above</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_data(data <span class="op">=</span> data):</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (data</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            .assign(days_before <span class="op">=</span> data[<span class="st">'days_before'</span>].<span class="bu">str</span>.extract(<span class="vs">r'(\d+)'</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                    day_of_week <span class="op">=</span> fix_dow,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                    category <span class="op">=</span> data[<span class="st">'category'</span>].replace(<span class="st">"-"</span>, <span class="st">"unknown"</span>))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            .astype({<span class="st">"days_before"</span>:<span class="st">"int"</span>, <span class="st">"day_of_week"</span>:<span class="st">"category"</span>, <span class="st">"time"</span>:<span class="st">"category"</span>, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"category"</span>:<span class="st">"category"</span>, <span class="st">"attended"</span>:<span class="st">"category"</span>})</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            .drop(<span class="st">"booking_id"</span>, axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># drop booking id column</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># let's store the clean dataframe in a new variable</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>clean_data <span class="op">=</span> clean_data()</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>clean_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="166">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months_as_member</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">days_before</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">attended</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>17</td>
<td>79.56</td>
<td>8</td>
<td>Wed</td>
<td>PM</td>
<td>Strength</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10</td>
<td>79.01</td>
<td>2</td>
<td>Mon</td>
<td>AM</td>
<td>HIIT</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>16</td>
<td>74.53</td>
<td>14</td>
<td>Sun</td>
<td>AM</td>
<td>Strength</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5</td>
<td>86.12</td>
<td>10</td>
<td>Fri</td>
<td>AM</td>
<td>Cycling</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>15</td>
<td>69.29</td>
<td>8</td>
<td>Thu</td>
<td>AM</td>
<td>HIIT</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can look at the output of the cleaned data. Let’s validate this data using a utility functions I have written. This will check the columns to see if they contain valid categories or are in valid numerical range.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> validate</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>validate(clean_data, data_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>"months_as_member" passed the validation test
"weight" passed the validation test
"days_before" passed the validation test
"day_of_week" passed the validation test
"time" passed the validation test
"category" passed the validation test
"attended" passed the validation test</code></pre>
</div>
</div>
<p>as we can see the data has passed the validation tests that were defined. <br></p>
</section>
<section id="does-the-data-have-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="does-the-data-have-missing-values">Does the data have missing values?</h4>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clean_data.isna().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>months_as_member     0
weight              20
days_before          0
day_of_week          0
time                 0
category             0
attended             0
dtype: int64</code></pre>
</div>
</div>
<ul>
<li>it looks like the weight column has few missing values</li>
<li>we will have to impute these values later before we train the model</li>
<li>let’s keep going for now <br> <strong>This ends the section on data validation and cleaning. Now we will start analyzing the data</strong></li>
</ul>
</section>
</section>
<section id="visual-inspection" class="level2">
<h2 class="anchored" data-anchor-id="visual-inspection">5. Visual inspection</h2>
<ul>
<li>now that we have cleaned the data it is time to start analyzing it.</li>
<li>Let’s take a look at basic summary statistics for the numerical variables</li>
</ul>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>clean_data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="169">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">months_as_member</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">days_before</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1500.000000</td>
<td>1480.000000</td>
<td>1500.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>15.628667</td>
<td>82.610378</td>
<td>8.346667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>12.926543</td>
<td>12.765859</td>
<td>4.077938</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.000000</td>
<td>55.410000</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>8.000000</td>
<td>73.490000</td>
<td>4.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>12.000000</td>
<td>80.760000</td>
<td>9.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>19.000000</td>
<td>89.520000</td>
<td>12.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>148.000000</td>
<td>170.520000</td>
<td>29.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>it doesn’t look like there are any anomalies in this data. so we can keep going</p>
<section id="lets-see-the-distribution-of-our-target-variable." class="level4">
<h4 class="anchored" data-anchor-id="lets-see-the-distribution-of-our-target-variable.">Let’s see the distribution of our target variable.</h4>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.countplot(data <span class="op">=</span> clean_data, x <span class="op">=</span> <span class="st">'attended'</span>, width<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(labels<span class="op">=</span>[<span class="st">'No'</span>, <span class="st">'Yes'</span>])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ax.bar_label(ax.containers[<span class="dv">0</span>], label_type<span class="op">=</span><span class="st">'center'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Attended the class or not?"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-9-output-1.png" width="634" height="466" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>We can see that the amount of people that did not attend the class is more than twice the amount of the people that did attend the class</li>
<li>So the classes for our target variable are imbalanced</li>
<li>Here we have to be careful due to this.</li>
<li>A model that predicts every Member as someone not attending the class will still have about 70% accuracy</li>
<li>Is machine learning even the right approach to solve this problem?</li>
<li>If the percentage of members who attend the class is pretty consistent you could just oversell the tickets?</li>
<li>There are lots of point of views from which you can think about this problem. for now we will simply continue the analysis</li>
</ul>
</section>
<section id="next-we-will-take-a-look-at-the-months_as_member-column" class="level4">
<h4 class="anchored" data-anchor-id="next-we-will-take-a-look-at-the-months_as_member-column">Next we will take a look at the “months_as_member” column</h4>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> clean_data, x <span class="op">=</span> <span class="st">'months_as_member'</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of "months as member"'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-10-output-1.png" width="665" height="486" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The distribution is right skewed</li>
<li>It looks like most of the members have been members for between 1 to 20 months and then there’s smaller proportion of people who have been members for longer than that.</li>
<li>There are few outliers here who have been members a lot longer than everyone else which have given a long right tail to the distribution</li>
</ul>
</section>
<section id="we-can-look-at-this-distribution-with-a-log-scale-on-x-axis" class="level4">
<h4 class="anchored" data-anchor-id="we-can-look-at-this-distribution-with-a-log-scale-on-x-axis">We can look at this distribution with a log scale on x-axis**</h4>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> clean_data, x <span class="op">=</span> <span class="st">'months_as_member'</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">'log'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of "months as member (log scale)"'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-11-output-1.png" width="665" height="493" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lets-look-at-the-relationship-between-months_as_member-and-whether-the-person-attends-the-class-or-not" class="level4">
<h4 class="anchored" data-anchor-id="lets-look-at-the-relationship-between-months_as_member-and-whether-the-person-attends-the-class-or-not">Let’s look at the relationship between “months_as_member” and whether the person attends the class or not</h4>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> plt.style.context(<span class="st">'dark_background'</span>):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    sns.stripplot(data <span class="op">=</span> clean_data, x<span class="op">=</span><span class="st">'attended'</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                  y<span class="op">=</span><span class="st">'months_as_member'</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                  alpha<span class="op">=</span><span class="fl">0.5</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    sns.pointplot(data<span class="op">=</span>clean_data, x<span class="op">=</span><span class="st">'attended'</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                  estimator<span class="op">=</span><span class="st">'mean'</span>,  y<span class="op">=</span><span class="st">'months_as_member'</span>, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">'white'</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    attended <span class="op">=</span> clean_data[<span class="st">'attended'</span>].replace({<span class="dv">0</span>:<span class="st">"No"</span>, <span class="dv">1</span>:<span class="st">"Yes"</span>})</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    sns.ecdfplot(data<span class="op">=</span>clean_data, x<span class="op">=</span><span class="st">'months_as_member'</span>, hue<span class="op">=</span>attended, ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    plt.setp(ax[<span class="dv">0</span>].lines, zorder<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    plt.setp(ax[<span class="dv">0</span>].collections, zorder<span class="op">=</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].grid(<span class="va">False</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].grid(<span class="va">False</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].margins(x<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].annotate(<span class="st">"Average for both categories"</span>, xy<span class="op">=</span>(<span class="fl">0.4</span>, <span class="dv">20</span>), xytext<span class="op">=</span>(<span class="fl">0.2</span>, <span class="dv">100</span>), arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'black'</span>, shrink<span class="op">=</span><span class="fl">0.05</span>))</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Number of months as member of club"</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Attended the class?"</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xticklabels([<span class="st">'No'</span>, <span class="st">"yes"</span>])</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].annotate(xy<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.95</span>), xytext<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.85</span>), textcoords <span class="op">=</span><span class="st">'axes fraction'</span>, text<span class="op">=</span><span class="st">"The people who attend the class are </span><span class="ch">\n</span><span class="st"> more likely to have been member of </span><span class="ch">\n</span><span class="st"> the club for longer time"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-12-output-1.png" width="963" height="434" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ok-there-is-a-lot-of-unpack-here" class="level4">
<h4 class="anchored" data-anchor-id="ok-there-is-a-lot-of-unpack-here">ok there is a lot of unpack here :)</h4>
<ol type="1">
<li>In the right graph we can see how many months each person has been member of the club and whether they attended the class or not.</li>
<li>The points for members who did not attend are closely stacked togethere whereas the points for people who did attend are more spread out and have longer range.</li>
<li><strong>The white points joind by a line show the average of <em>months as member</em> for both categories</strong></li>
<li>we can see a clear difference there. It’s not very big but it is definitely noticeble.</li>
<li>The right graph shows a ECDF for both categories.</li>
<li>we can see that people who attended the event are more likely to have higher number of months as members of the club <br> Ok! This was just some quick analysis. before we go any further into our analysis</li>
</ol>
<ul>
<li>we will split the data into train and test set first</li>
<li>we don’t want to learn patterns from test set too much so before doing a deeper analysis we will separate them</li>
</ul>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtaining a train test split</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> clean_data.drop(<span class="st">"attended"</span>, axis<span class="op">=</span><span class="dv">1</span>), clean_data[<span class="st">"attended"</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, stratify<span class="op">=</span>y, random_state<span class="op">=</span><span class="dv">241</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="first-of-all-lets-look-at-relationship-between-all-the-features-and-our-target-variable." class="level4">
<h4 class="anchored" data-anchor-id="first-of-all-lets-look-at-relationship-between-all-the-features-and-our-target-variable.">First of all let’s look at relationship between all the features and our target variable.</h4>
<p>i’m gonna go ahead and write a function that will provide us with plots for this</p>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> get_relations</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>get_relations(dataframe <span class="op">=</span> X_train, y <span class="op">=</span> y_train,  which<span class="op">=</span><span class="st">"numerics"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-14-output-1.png" width="963" height="503" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>we can see here that the months_as_member and weight column have some correlation with the target variable.</li>
<li>Depending on whether the target variable is “yes” or “no” the distribution of these features has slight difference</li>
<li>on the other hand the days_before column doesn’t seem to have any correlation with the target variable as the distribution for both the category of target variable seem pretty similar</li>
<li>one other observation is that the months_as_member and weight column seem to few outliers that might affect the model performance later.</li>
</ul>
</section>
<section id="now-lets-take-a-look-at-categorical-columns" class="level4">
<h4 class="anchored" data-anchor-id="now-lets-take-a-look-at-categorical-columns">Now let’s take a look at categorical columns <br></h4>
<p>we will look at how the proportions of the categorical variables are distributed for our target variable.</p>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>get_relations(dataframe <span class="op">=</span> X_train, y <span class="op">=</span> y_train, which<span class="op">=</span><span class="st">"categoricals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-15-output-1.png" width="947" height="809" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>what we can see in this plot is the variables “day_of_week”, “time” and “category” and how they are distributed across our target classes</li>
<li>I normalized the counts so we can look at the proportions and compare to see if any of these categorical features have any correlation with the target</li>
<li>looking at these plots it doesn’t look like there is any clear correlation.</li>
</ul>
</section>
<section id="next-we-will-take-a-look-at-how-the-numeric-feature-are-distributed-and-do-they-have-any-correlation-with-each-other" class="level4">
<h4 class="anchored" data-anchor-id="next-we-will-take-a-look-at-how-the-numeric-feature-are-distributed-and-do-they-have-any-correlation-with-each-other">Next, we will take a look at how the numeric feature are distributed and do they have any correlation with each other?</h4>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sns.pairplot(data <span class="op">=</span> X_train)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-16-output-1.png" width="709" height="709" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>We already know that the “Months_as_member” and “weight” features have some correlation with the target</li>
<li>here it looks like they are also related to each other sightly</li>
<li>let’s take a look at these two columns</li>
</ul>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>clean_data, x<span class="op">=</span><span class="st">'months_as_member'</span>, y<span class="op">=</span><span class="st">"weight"</span>, hue<span class="op">=</span>y_train)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">'log'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-17-output-1.png" width="665" height="473" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>since the months as member feature has skewed distribution I Have to put it on a <strong>Log-Scale</strong></li>
<li>here we can see that it seems like there is some negative correlation between these two features</li>
<li>it makes sense that people with longer duration are likely to have lower weight as they are more likely to workout regularly.</li>
<li>another thing we can see is that the members with higher months as members are likely to attend the class they registered to</li>
</ul>
</section>
</section>
<section id="preprocessing-and-building-pipeline." class="level2">
<h2 class="anchored" data-anchor-id="preprocessing-and-building-pipeline.">6. Preprocessing and Building Pipeline.</h2>
<ul>
<li>We have looked at the distributions of the data</li>
<li>we also looked at how the various features are related to the target variable as well as relationship between categorical features</li>
<li>The next step is to prepare the data for training a machine learning model</li>
<li>We will create a pipeline that does all these things for us</li>
<li>I will also include a step for <strong>Removing Outliers</strong> from the data inside the pipeline. Since sci-kit learn doesn’t allow for this functionality I will be using <strong>imbalanced-learn</strong> to implement that. You can find out more about it <a href="https://imbalanced-learn.org/stable/auto_examples/applications/plot_outlier_rejections.html">here</a></li>
</ul>
<section id="the-process-of-removing-outliers." class="level4">
<h4 class="anchored" data-anchor-id="the-process-of-removing-outliers.">The process of removing outliers.</h4>
<ul>
<li>I will write a custom function which will do following things
<ol type="1">
<li>It will take X_train and Y_train</li>
<li>It will remove any rows corresponding to outliers from X_train and y_train</li>
<li>The outliers here will be any observations that are outside of 3 standard deviations of the distribution.</li>
</ol></li>
<li>Before removing outliers we will also do other preprocessing steps such as
<ol type="1">
<li>Imputing missing values for the weight column</li>
<li>Encoding the Categorical variables</li>
<li>after that outiler rejection will take place</li>
<li>and lastly we will scale and standardize the data</li>
</ol></li>
</ul>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn <span class="im">import</span> FunctionSampler</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>onehot <span class="op">=</span> OneHotEncoder()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>ordEnc <span class="op">=</span> OrdinalEncoder()</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {<span class="st">"Logistic"</span>:LogisticRegression(),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">"SVC"</span>:SVC(),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">"KNN"</span>:KNeighborsClassifier()</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(transformers<span class="op">=</span>[</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>                                (<span class="st">"Imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'mean'</span>),[<span class="st">'weight'</span>]),</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">"CatEncoder"</span>, onehot, [<span class="st">"category"</span>, <span class="st">"day_of_week"</span>]),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>                (<span class="st">"OrdEnc"</span>, ordEnc, [<span class="st">"time"</span>])],</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                remainder<span class="op">=</span> <span class="st">"passthrough"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>What I have done here is import all the necessary estimators and transformers that will be used for preprocessing and model training</li>
<li>I have created a Instance of Column transformer that will operate on the categorical and numeric columns seperately and output the cleaned features</li>
</ul>
</section>
<section id="models" class="level3">
<h3 class="anchored" data-anchor-id="models">6.1 Models</h3>
<ul>
<li>As can be seen I have created instances of three different models for training which are as following
<ol type="1">
<li><strong>Logistic Regression</strong> - A linear classifier that is simple to explain and train.</li>
<li><strong>Support vector machines</strong> - another similar model that can fit to both linear and non linear patterns in the data</li>
<li><strong>K-Neighbours Classifier</strong> - For a different approach this model classifies the data points based on the euclidean or manhattan distance in N-dimensional space. we will train these three models and see which one performs good enough or is this data even good enough to make predictions.</li>
</ol></li>
</ul>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> outlier_rejection</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_scores(model_dict, X, y, metric):</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This function returns training score and</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    cross validation score for various models</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    _____________________________________________________</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    params</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">    model_dict: (dict) model name and model instance</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">    X: X_train array</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">    y: y_train arrray</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    model_names <span class="op">=</span> []</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    training_score <span class="op">=</span> []</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    cross_validation_scores <span class="op">=</span> []</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, model <span class="kw">in</span> model_dict.items():</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        pipeline <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                           (<span class="st">"outlier_rejection"</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                            FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                           (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                           (<span class="st">"model"</span>, model)])</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        pipeline.fit(X, y.values)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        model_names.append(name)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        training_score.append(pipeline.score(X, y.values))</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        avg_cross_val_score <span class="op">=</span> np.mean(cross_val_score(pipeline, X, y.values,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                                          cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span>metric))</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>        cross_validation_scores.append(avg_cross_val_score)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">"training_score"</span>:training_score,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"cross_val_score"</span>:cross_validation_scores},</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                     index<span class="op">=</span>model_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pipeline" class="level3">
<h3 class="anchored" data-anchor-id="pipeline">6.2 Pipeline</h3>
<ul>
<li>In the above code cell, have basically defined a function that uses the pipeline we have created to train the models we have defined</li>
<li>It will calculate the training scores and the cross validation scores for us of each model.</li>
<li>The basic steps in this pipeline are
<ol type="1">
<li>Column transformation which includes imputation and categorical variable encoding</li>
<li>Next step is removing outliers from the training data. <strong>Note the outliers will only be removed from the training data and not from the testing data</strong></li>
<li>After this scaling and training takes place.</li>
</ol></li>
</ul>
</section>
<section id="model-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation">6.3 Model evaluation</h3>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> get_scores(model_dict <span class="op">=</span> models, X <span class="op">=</span> X_train, y <span class="op">=</span> y_train, metric<span class="op">=</span><span class="st">"accuracy"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>scores.plot.bar()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="181">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-20-output-2.png" width="642" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Here we can see that Logistic regression has best cross validation score and it’s the simplest model</li>
<li>SVC is pretty similar in results and it doesn’t look like it’s overfitting the training data</li>
<li>The KNN model has the highest training accuracy but lowest cross validation accuracy which means it’s overfitting the training data.</li>
<li><strong>Not the thing to keep in mind when looking at these metrics is accuracy is not a good metric to judge a classification models, specially when the target variable is highly inbalanced.</strong></li>
<li>Let’s calculate ROC_AUC scores for each model using cross vaidation to see how they are really performing.</li>
</ul>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> get_scores(model_dict <span class="op">=</span> models, X <span class="op">=</span> X_train, y <span class="op">=</span> y_train, metric<span class="op">=</span><span class="st">"roc_auc"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>roc_auc[[<span class="st">"cross_val_score"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="182">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cross_val_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Logistic</td>
<td>0.796712</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SVC</td>
<td>0.768351</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">KNN</td>
<td>0.690112</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>Once again Logistic Regression has the best performance out of three models.</li>
<li>These ROC_AUC scores are pretty similar to what we say with accuracy.</li>
<li>But this does tell us that the model is not good just by a random chance. It has some good predictive ability.</li>
<li><strong>An even better metric for testing the models would be confusion_matrix</strong></li>
<li>Let’s see confusion matrix for each model on training data.</li>
</ul>
<div class="cell" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yellowbrick.classifier <span class="im">import</span> ConfusionMatrix</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's use a subset of above mentioned function to do this. </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> confusion():</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"outlier_rejection"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                                FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                               ])</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    x_train_c, y_train_c <span class="op">=</span> pipeline.fit_resample(X_train, y_train.values)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    x_train_scale <span class="op">=</span> StandardScaler().fit_transform(x_train_c)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model <span class="kw">in</span> models.values():</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        cm <span class="op">=</span> ConfusionMatrix(model, encoder<span class="op">=</span>{<span class="dv">1</span>:<span class="st">"yes"</span>, <span class="dv">0</span>:<span class="st">"No"</span>}, ax<span class="op">=</span>ax)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        cm.fit(x_train_scale, y_train_c)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        cm.score(x_train_scale, y_train_c)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        cm.show()</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>confusion()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-22-output-1.png" width="369" height="368" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-22-output-2.png" width="369" height="368" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-22-output-3.png" width="369" height="368" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Here we can see very granular view of how the models are fitting on the data</li>
<li>As we can see All three of the models have good accuracy when it comes to classifying people “Not” attending the class</li>
<li>But the catch here is that the models flag about half of the people who will attend the class and people who will not.</li>
<li>Due to this reason the model has high prediction error when it comes to positive class.</li>
<li>Alright this was base models. Not let’s do some hyperparameter tuning on these models and check out their the results.</li>
</ul>
</section>
</section>
<section id="hyperparameter-tuning" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameter-tuning">7. Hyperparameter Tuning</h2>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"Logistic"</span>:  </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>          {<span class="st">"model__solver"</span> : [<span class="st">"newton-cg"</span> , <span class="st">"lbfgs"</span>, <span class="st">"liblinear"</span>, <span class="st">"sag"</span>, <span class="st">"saga"</span>], </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"model__penalty"</span>: [<span class="st">"l1"</span>, <span class="st">"l2"</span>, <span class="st">"elasticnet"</span>],</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"model__C"</span>: [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>]}, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"SVC"</span> : </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>          {<span class="st">'model__kernel'</span>:[<span class="st">'linear'</span>, <span class="st">'poly'</span>, <span class="st">'rbf'</span>, <span class="st">'sigmoid'</span>],</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'model__C'</span>: [<span class="dv">100</span>, <span class="dv">10</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>, <span class="fl">0.001</span>]}, </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">"KNN"</span>: </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>          {<span class="st">"model__n_neighbors"</span>: np.arange(<span class="dv">1</span>,<span class="dv">21</span>,<span class="dv">1</span>),</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">"model__metric"</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'minkowski'</span>],</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>           <span class="st">"model__weights"</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>]}</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>         }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>In above code cell I have created a nested dictionary that contains hyperparameters for each model. I know that’s a lot of parameters but we can afford to do exhaustive search due to dataset being very small. Now I will write a custom function that uses </strong>GridSeachCV** from scikit-learn and give us best parameters for each model.</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="op">=</span> []</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>best_scores <span class="op">=</span> []</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tune_model(model, param_grid):</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"outlier_rejection"</span>,FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"model"</span>, model)])</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    GSC <span class="op">=</span> GridSearchCV(pipeline, param_grid<span class="op">=</span>param_grid, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                           cv <span class="op">=</span> <span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'roc_auc'</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    GSC.fit(X_train, y_train.values)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    hyperparameters.append(GSC.best_params_)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    best_scores.append(GSC.best_score_)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    estimator <span class="op">=</span> model</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    tune_model(estimator, params[name])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> hyperparameters:</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>{'model__C': 0.1, 'model__penalty': 'l1', 'model__solver': 'liblinear'} 

{'model__C': 0.001, 'model__kernel': 'linear'} 

{'model__metric': 'euclidean', 'model__n_neighbors': 18, 'model__weights': 'distance'} 

[0.8062869839716708, 0.8039794240429373, 0.7135280883118631]</code></pre>
</div>
</div>
<ul>
<li>here we can see the hyperparameters chosen for the models and the best accuracy that was obtaind by those parameters.</li>
<li>Overall Logistic Regression model has performed most consistently during this analysis and that’s the one we will use as the final model here</li>
<li>Let’s train a final model and test it on test set.</li>
</ul>
</section>
<section id="final-training." class="level2">
<h2 class="anchored" data-anchor-id="final-training.">8. Final Training.</h2>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                         (<span class="st">"outlier_rejection"</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                          FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                          (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                          (<span class="st">"LogisticRegression"</span>, </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                          LogisticRegression(C<span class="op">=</span><span class="fl">0.1</span>, penalty<span class="op">=</span><span class="st">'l1'</span>,solver<span class="op">=</span><span class="st">'liblinear'</span>))])</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>logreg.fit(X_train, y_train.values)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>logreg.score(X_test, y_test.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="187">
<pre><code>0.8044444444444444</code></pre>
</div>
</div>
<ul>
<li>Finally we can see the performance of our model on the test data</li>
<li>This doesnt tell us much though, let’s look at some more metrics.</li>
</ul>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yellowbrick.classifier <span class="im">import</span> ClassificationReport</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>cr <span class="op">=</span> ClassificationReport(logreg, encoder<span class="op">=</span>{<span class="dv">0</span>:<span class="st">"No"</span>, <span class="dv">1</span>:<span class="st">"Yes"</span>})</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>cr.fit(X_train, y_train.values)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>cr.score(X_test, y_test.values)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>cr.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-27-output-1.png" width="696" height="512" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="188">
<pre><code>&lt;Axes: title={'center': 'LogisticRegression Classification Report'}&gt;</code></pre>
</div>
</div>
</section>
<section id="final-thougts" class="level2">
<h2 class="anchored" data-anchor-id="final-thougts">9. Final Thougts</h2>
<ol type="1">
<li>Logistic Regression and SVM machines achieved fairly similar results on the train set</li>
<li>Logistic Regression is slightly better than SVM and seems like the best fit as the solution for GoalZone.</li>
<li>The reason both of these models performed better than the K nearest neighbor is because they used linear decision boundaries.</li>
</ol>
<div class="cell" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yellowbrick.classifier <span class="im">import</span> class_prediction_error</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>class_prediction_error(logreg, X_train, y_train.values, X_test, y_test.values, encoder<span class="op">=</span>{<span class="dv">0</span>:<span class="st">"No"</span>, <span class="dv">1</span>:<span class="st">"Yes"</span>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="main_analysis_files/figure-html/cell-28-output-1.png" width="672" height="512" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>we can see prediction error for both of the classes here.</li>
<li>Overall the model is performing better than just doing random guesses but It’s hard to tell if it’s really a significant difference.</li>
<li>There should be more investigation done into this and different approaches need to be tried.</li>
<li>This problem can also be looked at through the lens of time series and see if it’s possible to predict class attendence over time.</li>
<li>The data provided was very small in size and collecting more data with better features is also a good idea.</li>
<li>In this dataset there weren’t a lot of features that explained the target variable well besides weight and Months_as_member</li>
<li>If GoalZone wants to use this model for freeing up more seats for their classes about 65-75% seats can be freed according to the model. Again there might be some time series components here that need to be looked at but if you keep the prediction error in mind the business should be able to free up more seats.</li>
</ul>
<hr>
<p><strong>References</strong> 1. <a href="https://app.datacamp.com/">datacamp</a> 2. <a href="https://pandas.pydata.org/">pandas</a> 3. <a href="https://numpy.org/">Numpy</a> 4. <a href="https://scikit-learn.org/stable/">Scikit-learn</a> 5. <a href="https://matplotlib.org/">Matplotlib</a> 6. <a href="https://imbalanced-learn.org/stable/">Imbalanced-learn</a> 7. <a href="https://quarto.org/">Quarto</a></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Predicting customer behaviour using scikit learn"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Anurag Patil</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">    grid:</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">      body-width: 1000px</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">      margin-width: 150px</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: Solar</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: sans-serif</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">    monofont: monospace</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-expand: true</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="an">panel:</span><span class="co"> center</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> data_science</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Before getting into the report</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>All the code cells are collapsed so the reader can focus on the analysis</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Although if you are interested in looking at the code at certain part you can unfold the code block just by clicking on the **"Code"** button provided. </span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>If you are interested in looking at all the code you can unfold all the code cells at once by using the option in right hand corner. Alternatively you can go to the github repositery where all the code for this is hosted. </span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">repositery</span><span class="co">](https://github.com/ANP-Oxy/GoalZone)</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is a revamped version of the original case study that I worked on for DataCamp's **"Data Scientist Associate certification".**</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The dataset as well as the problem scenario was provided by DataCamp. </span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this report I will be working on a fictitious business scenario, dealing with a customer behaviour classification problem. </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I will clean the data, validate it, do some visual insepction of the data and then work on modelling it. </span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The tools used for this analysis are python, numpy, pandas, matplotlib, seaborn, scikit-learn, imbalanced learn and the report was generated using Quarto. </span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Scenario</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GoalZone is a fitness club chain in Canada.</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GoalZone offers a range of fitness classes in two capacities - 25 and 15.</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Some classes are always fully booked. Fully booked classes often have a low attendance rate.</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GoalZone wants to increase the number of spaces available for classes.</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>They want to do this by predicting whether the member will attend the class or not.</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If they can predict a member will not attend the class, they can make another space</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  available.</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Data</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing the necessary modules</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn"</span>)</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="co"># let's get the data</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://s3.amazonaws.com/talent-assets.datacamp.com/fitness_class_2212.csv"</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="co"># this will fetch the data and put it into a dataframe. </span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>data.head()</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>**The data has 8 columns and 1500 rows**<span class="kw">&lt;br&gt;</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>The basic descriptions of the columns are.<span class="kw">&lt;br&gt;</span> </span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>unique booking id</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The number of months as this fitness club member</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>weight </span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>The number of days before the class the member registered</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>day of week of the class</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>time of class</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>category</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>The last column attended shows whether the member attended the class or not with 0 corresponding to "No" and 1 to "Yes".</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Defining the problem</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**The business wants to predict whether members will attend using the data provided**</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here even though the specific task about predicting whether the member will attend the class or not we should keep in mind that the end goal to increase the number of members joining the class. </span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Keeping the big picture in the back of the mind before diving into analysis is necessary. </span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now, about the data since our target variable is binary this is essentially a **Binary Classification** problem</span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have to predict whether the member who has registered for the class will attend the class or not. </span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>Now that we have taken a glimpse of the data, decided what our end goal is let's get into the actual analysis. we will go through this step by step by first validating the data then doing some Exploratory analysis and finally training some machine learning models. </span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Data cleaning and validation. </span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>Let's take a look at some information about the columns </span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>"months_as_member" : 1 is minimum value for this column</span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>"weight" : 40.00 is minimum value</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>"days_before" : 1 is minimum value</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>"day_of_week" : "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun" are valid values</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>"time" : "AM" , "PM" are valid values</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>"category" : "Yoga", "Aqua" , "Strength", "HIIT", "Cycling", "unknown" are valid values</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>"attended" : 1, 0 are valid values</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>Below I'm creating a python dictionary that contains some metadata about the data we have. This will be used later on to validate the integrity of the data. </span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>data_dict <span class="op">=</span> {<span class="st">"booking_id"</span>  : <span class="st">"The unique identifier of the booking."</span>,</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>                <span class="st">"months_as_member"</span> : <span class="dv">1</span>, <span class="co"># minimum value for this column</span></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>                <span class="st">"weight"</span> : <span class="fl">40.00</span>, <span class="co"># minimum value</span></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>                <span class="st">"days_before"</span> : <span class="dv">1</span>, <span class="co"># minimum value</span></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>                <span class="st">"day_of_week"</span> : [<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>], <span class="co"># valid categories</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>                <span class="st">"time"</span> : [<span class="st">"AM"</span> , <span class="st">"PM"</span>], <span class="co"># valid categories</span></span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>                <span class="st">"category"</span> : [<span class="st">"Yoga"</span>, <span class="st">"Aqua"</span> , <span class="st">"Strength"</span>, <span class="st">"HIIT"</span>, <span class="st">"Cycling"</span>, <span class="st">"unknown"</span>], <span class="co"># valid categories</span></span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>                <span class="st">"attended"</span> : [<span class="dv">1</span>, <span class="dv">0</span>] <span class="co"># valid categories</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Let's take a look at what kind of problems the data has. &lt;br&gt;</span></span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a>first we will check the categorical columns </span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, attr.output='.details summary="Output"'}</span></span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the categorical columns</span></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Print value counts for each of those columns</span></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> data.select_dtypes(<span class="st">"object"</span>).columns:        </span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> :</span><span class="ch">\n</span><span class="sc">{</span>data[column]<span class="sc">.</span>value_counts()<span class="sc">}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">"</span>) </span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>**I have disabled the output here because it is very long but you can execute the code and take a look at it**<span class="kw">&lt;br&gt;</span></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>**The problems identified in the categorical columns are**</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The days before column is not completely numeric and some cells have "days" string written alongside the number of days. This is data entry incosistency and needs to be fixed. </span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The day of the week also has data entry errors and the weekday names aren't consistent. </span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The time columns seems fine</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>category column has "-" as values in few columns which will need to be replaced. </span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>**I will peform series of operations on the data and fix the problems mentioned above.**</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a> 1) first we fix the days before column by elimination string characters from it</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a> 2) next we fixed the day_of_week column by using the function defind above</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a> 3) then fix the category column by replacing "-" with "unknown"</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a> 4) after that we change the datatypes of the columns</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a> 5) lastly drop the "booking_id" column as it is not useful</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a function to fix the day_of_week column</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fix_dow(df):</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day_of_week'</span>] <span class="op">=</span> df[<span class="st">'day_of_week'</span>].<span class="bu">str</span>.replace(<span class="st">'Fri.'</span>, <span class="st">"Fri"</span>)</span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day_of_week'</span>] <span class="op">=</span> df[<span class="st">'day_of_week'</span>].<span class="bu">str</span>.replace(<span class="st">'Monday'</span>, <span class="st">"Mon"</span>)</span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day_of_week'</span>] <span class="op">=</span> df[<span class="st">'day_of_week'</span>].<span class="bu">str</span>.replace(<span class="st">'Wednesday'</span>, <span class="st">"Wed"</span>)</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[<span class="st">'day_of_week'</span>]</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="co"># this fuction will carry out cleaning steps outlined above</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_data(data <span class="op">=</span> data):</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (data</span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>            .assign(days_before <span class="op">=</span> data[<span class="st">'days_before'</span>].<span class="bu">str</span>.extract(<span class="vs">r'(\d+)'</span>),</span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>                    day_of_week <span class="op">=</span> fix_dow,</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>                    category <span class="op">=</span> data[<span class="st">'category'</span>].replace(<span class="st">"-"</span>, <span class="st">"unknown"</span>))</span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>            .astype({<span class="st">"days_before"</span>:<span class="st">"int"</span>, <span class="st">"day_of_week"</span>:<span class="st">"category"</span>, <span class="st">"time"</span>:<span class="st">"category"</span>, </span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"category"</span>:<span class="st">"category"</span>, <span class="st">"attended"</span>:<span class="st">"category"</span>})</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>            .drop(<span class="st">"booking_id"</span>, axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># drop booking id column</span></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a><span class="co"># let's store the clean dataframe in a new variable</span></span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>clean_data <span class="op">=</span> clean_data()</span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>clean_data.head()</span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>We can look at the output of the cleaned data.</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>Let's validate this data using a utility functions I have written. </span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>This will check the columns to see if they contain valid categories or are in valid numerical range. </span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> validate</span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>validate(clean_data, data_dict)</span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>as we can see the data has passed the validation tests that were defined. <span class="kw">&lt;br&gt;</span></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Does the data have missing values?</span></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clean_data.isna().<span class="bu">sum</span>())</span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>it looks like the weight column has few missing values</span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>we will have to impute these values later before we train the model</span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>let's keep going for now <span class="kw">&lt;br&gt;</span></span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>**This ends the section on data validation and cleaning. Now we will start analyzing the data**</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5. Visual inspection</span></span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>now that we have cleaned the data it is time to start analyzing it. </span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let's take a look at basic summary statistics for the numerical variables</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a>clean_data.describe()</span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>it doesn't look like there are any anomalies in this data. so we can keep going</span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Let's see the distribution of our target variable. </span></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.countplot(data <span class="op">=</span> clean_data, x <span class="op">=</span> <span class="st">'attended'</span>, width<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(labels<span class="op">=</span>[<span class="st">'No'</span>, <span class="st">'Yes'</span>])</span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([])</span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>ax.bar_label(ax.containers[<span class="dv">0</span>], label_type<span class="op">=</span><span class="st">'center'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Attended the class or not?"</span>)<span class="op">;</span></span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can see that the amount of people that did not attend the class is more than twice the amount of the people that did attend the class</span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So the classes for our target variable are imbalanced </span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here we have to be careful due to this. </span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A model that predicts every Member as someone not attending the class will still have about 70% accuracy</span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Is machine learning even the right approach to solve this problem? </span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the percentage of members who attend the class is pretty consistent you could just oversell the tickets? </span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are lots of point of views from which you can think about this problem. for now we will simply continue the analysis</span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Next we will take a look at the "months_as_member" column</span></span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> clean_data, x <span class="op">=</span> <span class="st">'months_as_member'</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of "months as member"'</span>)<span class="op">;</span></span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The distribution is right skewed </span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It looks like most of the members have been members for between 1 to 20 months and then there's smaller proportion of people who have been members for longer than that.</span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are few outliers here who have been members a lot longer than everyone else which have given a long right tail to the distribution</span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a><span class="fu">#### We can look at this distribution with a log scale on x-axis**</span></span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>sns.histplot(data <span class="op">=</span> clean_data, x <span class="op">=</span> <span class="st">'months_as_member'</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">'log'</span>)</span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of "months as member (log scale)"'</span>)<span class="op">;</span></span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Let's look at the relationship between "months_as_member" and whether the person attends the class or not</span></span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> plt.style.context(<span class="st">'dark_background'</span>):</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>    sns.stripplot(data <span class="op">=</span> clean_data, x<span class="op">=</span><span class="st">'attended'</span>, </span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a>                  y<span class="op">=</span><span class="st">'months_as_member'</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, </span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a>                  alpha<span class="op">=</span><span class="fl">0.5</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a>    sns.pointplot(data<span class="op">=</span>clean_data, x<span class="op">=</span><span class="st">'attended'</span>,</span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>                  estimator<span class="op">=</span><span class="st">'mean'</span>,  y<span class="op">=</span><span class="st">'months_as_member'</span>, </span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">'white'</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a>    attended <span class="op">=</span> clean_data[<span class="st">'attended'</span>].replace({<span class="dv">0</span>:<span class="st">"No"</span>, <span class="dv">1</span>:<span class="st">"Yes"</span>})</span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a>    sns.ecdfplot(data<span class="op">=</span>clean_data, x<span class="op">=</span><span class="st">'months_as_member'</span>, hue<span class="op">=</span>attended, ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a>    plt.setp(ax[<span class="dv">0</span>].lines, zorder<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a>    plt.setp(ax[<span class="dv">0</span>].collections, zorder<span class="op">=</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].grid(<span class="va">False</span>)</span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].grid(<span class="va">False</span>)</span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].margins(x<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>)</span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].annotate(<span class="st">"Average for both categories"</span>, xy<span class="op">=</span>(<span class="fl">0.4</span>, <span class="dv">20</span>), xytext<span class="op">=</span>(<span class="fl">0.2</span>, <span class="dv">100</span>), arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'black'</span>, shrink<span class="op">=</span><span class="fl">0.05</span>))</span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Number of months as member of club"</span>)</span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Attended the class?"</span>)</span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_xticklabels([<span class="st">'No'</span>, <span class="st">"yes"</span>])</span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].annotate(xy<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.95</span>), xytext<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.85</span>), textcoords <span class="op">=</span><span class="st">'axes fraction'</span>, text<span class="op">=</span><span class="st">"The people who attend the class are </span><span class="ch">\n</span><span class="st"> more likely to have been member of </span><span class="ch">\n</span><span class="st"> the club for longer time"</span>)<span class="op">;</span></span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ok there is a lot of unpack here :)</span></span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>In the right graph we can see how many months each person has been member of the club and whether they attended the class or not. </span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The points for members who did not attend are closely stacked togethere whereas the points for people who did attend are more spread out and have longer range. </span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**The white points joind by a line show the average of _months as member_ for both categories** </span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>we can see a clear difference there. It's not very big but it is definitely noticeble. </span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>The right graph shows a ECDF for both categories. </span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>we can see that people who attended the event are more likely to have higher number of months as members of the club </span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a>Ok! This was just some quick analysis. before we go any further into our analysis</span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>we will split the data into train and test set first</span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>we don't want to learn patterns from test set too much so before doing a deeper analysis we will separate them</span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a><span class="co">#| cold-fold: false</span></span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtaining a train test split</span></span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> clean_data.drop(<span class="st">"attended"</span>, axis<span class="op">=</span><span class="dv">1</span>), clean_data[<span class="st">"attended"</span>]</span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, stratify<span class="op">=</span>y, random_state<span class="op">=</span><span class="dv">241</span>)</span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a><span class="fu">#### First of all let's look at relationship between all the features and our target variable. </span></span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a>i'm gonna go ahead and write a function that will provide us with plots for this</span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> get_relations</span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a>get_relations(dataframe <span class="op">=</span> X_train, y <span class="op">=</span> y_train,  which<span class="op">=</span><span class="st">"numerics"</span>)</span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>we can see here that the months_as_member and weight column have some correlation with the target variable.</span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Depending on whether the target variable is "yes" or "no" the distribution of these features has slight difference</span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>on the other hand the days_before column doesn't seem to have any correlation with the target variable as the distribution for both the category of target variable seem pretty similar</span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>one other observation is that the months_as_member and weight column seem to few outliers that might affect the model performance later. </span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Now let's take a look at categorical columns &lt;br&gt;</span></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a>we will look at how the proportions of the categorical variables are distributed for our target variable. </span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a>get_relations(dataframe <span class="op">=</span> X_train, y <span class="op">=</span> y_train, which<span class="op">=</span><span class="st">"categoricals"</span>)</span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>what we can see in this plot is the variables "day_of_week", "time" and "category" and how they are distributed across our target classes</span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I normalized the counts so we can look at the proportions and compare to see if any of these categorical features have any correlation with the target</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>looking at these plots it doesn't look like there is any clear correlation. </span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Next, we will take a look at how the numeric feature are distributed and do they have any correlation with each other?</span></span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a>sns.pairplot(data <span class="op">=</span> X_train)<span class="op">;</span></span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We already know that the "Months_as_member" and "weight" features have some correlation with the target</span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>here it looks like they are also related to each other sightly</span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>let's take a look at these two columns</span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>clean_data, x<span class="op">=</span><span class="st">'months_as_member'</span>, y<span class="op">=</span><span class="st">"weight"</span>, hue<span class="op">=</span>y_train)</span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>)</span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">'log'</span>)</span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>since the months as member feature has skewed distribution I Have to put it on a **Log-Scale**</span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>here we can see that it seems like there is some negative correlation between these two features</span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>it makes sense that people with longer duration are likely to have lower weight as they are more likely to workout regularly. </span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>another thing we can see is that the members with higher months as members are likely to attend the class they registered to</span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6. Preprocessing and Building Pipeline. </span></span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have looked at the distributions of the data</span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>we also looked at how the various features are related to the target variable as well as relationship between categorical features</span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The next step is to prepare the data for training a machine learning model </span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We will create a pipeline that does all these things for us </span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I will also include a step for **Removing Outliers** from the data inside the pipeline. Since sci-kit learn doesn't allow for this functionality I will be using **imbalanced-learn** to implement that. You can find out more about it <span class="co">[</span><span class="ot">here</span><span class="co">](https://imbalanced-learn.org/stable/auto_examples/applications/plot_outlier_rejections.html)</span></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The process of removing outliers. </span></span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I will write a custom function which will do following things</span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a><span class="ss">    1. </span>It will take X_train and Y_train</span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a><span class="ss">    2. </span>It will remove any rows corresponding to outliers from X_train and y_train</span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a><span class="ss">    3. </span>The outliers here will be any observations that are outside of 3 standard deviations of the distribution. </span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Before removing outliers we will also do other preprocessing steps such as </span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a><span class="ss">    1. </span>Imputing missing values for the weight column</span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a><span class="ss">    2. </span>Encoding the Categorical variables</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a><span class="ss">    3. </span>after that outiler rejection will take place</span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a><span class="ss">    4. </span>and lastly we will scale and standardize the data</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder</span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn <span class="im">import</span> FunctionSampler</span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a>onehot <span class="op">=</span> OneHotEncoder()</span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a>ordEnc <span class="op">=</span> OrdinalEncoder()</span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {<span class="st">"Logistic"</span>:LogisticRegression(),</span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a>          <span class="st">"SVC"</span>:SVC(),</span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a>          <span class="st">"KNN"</span>:KNeighborsClassifier()</span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(transformers<span class="op">=</span>[</span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a>                                (<span class="st">"Imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'mean'</span>),[<span class="st">'weight'</span>]),</span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">"CatEncoder"</span>, onehot, [<span class="st">"category"</span>, <span class="st">"day_of_week"</span>]),</span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a>                (<span class="st">"OrdEnc"</span>, ordEnc, [<span class="st">"time"</span>])],</span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a>                remainder<span class="op">=</span> <span class="st">"passthrough"</span>)</span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What I have done here is import all the necessary estimators and transformers that will be used for preprocessing and model training</span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I have created a Instance of Column transformer that will operate on the categorical and numeric columns seperately and output the cleaned features</span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.1 Models</span></span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As can be seen I have created instances of three different models for training which are as following</span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a><span class="ss">  1. </span>**Logistic Regression** - A linear classifier that is simple to explain and train. </span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a><span class="ss">  2. </span>**Support vector machines** - another similar model that can fit to both linear and non linear patterns in the data</span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a><span class="ss">  3. </span>**K-Neighbours Classifier** - For a different approach this model classifies the data points based on the euclidean or manhattan distance in N-dimensional space. </span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a>we will train these three models and see which one performs good enough or is this data even good enough to make predictions. </span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> outlier_rejection</span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_scores(model_dict, X, y, metric):</span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a><span class="co">    This function returns training score and</span></span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a><span class="co">    cross validation score for various models</span></span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a><span class="co">    _____________________________________________________</span></span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a><span class="co">    params</span></span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a><span class="co">    model_dict: (dict) model name and model instance</span></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a><span class="co">    X: X_train array</span></span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a><span class="co">    y: y_train arrray</span></span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a>    model_names <span class="op">=</span> []</span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a>    training_score <span class="op">=</span> []</span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a>    cross_validation_scores <span class="op">=</span> []</span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, model <span class="kw">in</span> model_dict.items():</span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a>        pipeline <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a>                           (<span class="st">"outlier_rejection"</span>,</span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a>                            FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a>                           (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a>                           (<span class="st">"model"</span>, model)])</span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a>        pipeline.fit(X, y.values)</span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a>        model_names.append(name)</span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a>        training_score.append(pipeline.score(X, y.values))</span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a>        avg_cross_val_score <span class="op">=</span> np.mean(cross_val_score(pipeline, X, y.values,</span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a>                                          cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span>metric))</span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>        cross_validation_scores.append(avg_cross_val_score)</span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">"training_score"</span>:training_score,</span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"cross_val_score"</span>:cross_validation_scores},</span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a>                     index<span class="op">=</span>model_names)</span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.2 Pipeline</span></span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the above code cell, have basically defined a function that uses the pipeline we have created to train the models we have defined</span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It will calculate the training scores and the cross validation scores for us of each model. </span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The basic steps in this pipeline are</span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a><span class="ss">  1. </span>Column transformation which includes imputation and categorical variable encoding</span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a><span class="ss">  2. </span>Next step is removing outliers from the training data. **Note the outliers will only be removed from the training data and not from the testing data**</span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a><span class="ss">  3. </span>After this scaling and training takes place. </span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.3 Model evaluation</span></span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> get_scores(model_dict <span class="op">=</span> models, X <span class="op">=</span> X_train, y <span class="op">=</span> y_train, metric<span class="op">=</span><span class="st">"accuracy"</span>)</span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a>scores.plot.bar()</span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here we can see that Logistic regression has best cross validation score and it's the simplest model</span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>SVC is pretty similar in results and it doesn't look like it's overfitting the training data</span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The KNN model has the highest training accuracy but lowest cross validation accuracy which means it's overfitting the training data. </span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Not the thing to keep in mind when looking at these metrics is accuracy is not a good metric to judge a classification models, specially when the target variable is highly inbalanced.**</span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let's calculate ROC_AUC scores for each model using cross vaidation to see how they are really performing. </span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> get_scores(model_dict <span class="op">=</span> models, X <span class="op">=</span> X_train, y <span class="op">=</span> y_train, metric<span class="op">=</span><span class="st">"roc_auc"</span>)</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a>roc_auc[[<span class="st">"cross_val_score"</span>]]</span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Once again Logistic Regression has the best performance out of three models. </span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These ROC_AUC scores are pretty similar to what we say with accuracy. </span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But this does tell us that the model is not good just by a random chance. It has some good predictive ability. </span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**An even better metric for testing the models would be confusion_matrix** </span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let's see confusion matrix for each model on training data. </span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yellowbrick.classifier <span class="im">import</span> ConfusionMatrix</span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's use a subset of above mentioned function to do this. </span></span>
<span id="cb35-539"><a href="#cb35-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-540"><a href="#cb35-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> confusion():</span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"outlier_rejection"</span>,</span>
<span id="cb35-544"><a href="#cb35-544" aria-hidden="true" tabindex="-1"></a>                                FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb35-545"><a href="#cb35-545" aria-hidden="true" tabindex="-1"></a>                               ])</span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a>    x_train_c, y_train_c <span class="op">=</span> pipeline.fit_resample(X_train, y_train.values)</span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a>    x_train_scale <span class="op">=</span> StandardScaler().fit_transform(x_train_c)</span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model <span class="kw">in</span> models.values():</span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a>        cm <span class="op">=</span> ConfusionMatrix(model, encoder<span class="op">=</span>{<span class="dv">1</span>:<span class="st">"yes"</span>, <span class="dv">0</span>:<span class="st">"No"</span>}, ax<span class="op">=</span>ax)</span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a>        cm.fit(x_train_scale, y_train_c)</span>
<span id="cb35-553"><a href="#cb35-553" aria-hidden="true" tabindex="-1"></a>        cm.score(x_train_scale, y_train_c)</span>
<span id="cb35-554"><a href="#cb35-554" aria-hidden="true" tabindex="-1"></a>        cm.show()</span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a>confusion()</span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here we can see very granular view of how the models are fitting on the data</span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As we can see All three of the models have good accuracy when it comes to classifying people "Not" attending the class</span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But the catch here is that the models flag about half of the people who will attend the class and people who will not. </span>
<span id="cb35-560"><a href="#cb35-560" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Due to this reason the model has high prediction error when it comes to positive class. </span>
<span id="cb35-561"><a href="#cb35-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Alright this was base models. Not let's do some hyperparameter tuning on these models and check out their the results. </span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7. Hyperparameter Tuning</span></span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"Logistic"</span>:  </span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a>          {<span class="st">"model__solver"</span> : [<span class="st">"newton-cg"</span> , <span class="st">"lbfgs"</span>, <span class="st">"liblinear"</span>, <span class="st">"sag"</span>, <span class="st">"saga"</span>], </span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a>           <span class="st">"model__penalty"</span>: [<span class="st">"l1"</span>, <span class="st">"l2"</span>, <span class="st">"elasticnet"</span>],</span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a>           <span class="st">"model__C"</span>: [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>]}, </span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a>          <span class="st">"SVC"</span> : </span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a>          {<span class="st">'model__kernel'</span>:[<span class="st">'linear'</span>, <span class="st">'poly'</span>, <span class="st">'rbf'</span>, <span class="st">'sigmoid'</span>],</span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a>          <span class="st">'model__C'</span>: [<span class="dv">100</span>, <span class="dv">10</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>, <span class="fl">0.001</span>]}, </span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a>          <span class="st">"KNN"</span>: </span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a>          {<span class="st">"model__n_neighbors"</span>: np.arange(<span class="dv">1</span>,<span class="dv">21</span>,<span class="dv">1</span>),</span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a>          <span class="st">"model__metric"</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'minkowski'</span>],</span>
<span id="cb35-580"><a href="#cb35-580" aria-hidden="true" tabindex="-1"></a>           <span class="st">"model__weights"</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>]}</span>
<span id="cb35-581"><a href="#cb35-581" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a>**In above code cell I have created a nested dictionary that contains hyperparameters for each model. </span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a>I know that's a lot of parameters but we can afford to do exhaustive search due to dataset being very small. </span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a>Now I will write a custom function that uses **GridSeachCV** from scikit-learn and give us best parameters for each model. </span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-591"><a href="#cb35-591" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb35-592"><a href="#cb35-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-593"><a href="#cb35-593" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb35-594"><a href="#cb35-594" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="op">=</span> []</span>
<span id="cb35-595"><a href="#cb35-595" aria-hidden="true" tabindex="-1"></a>best_scores <span class="op">=</span> []</span>
<span id="cb35-596"><a href="#cb35-596" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tune_model(model, param_grid):</span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb35-598"><a href="#cb35-598" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"outlier_rejection"</span>,FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb35-599"><a href="#cb35-599" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a>                               (<span class="st">"model"</span>, model)])</span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a>    GSC <span class="op">=</span> GridSearchCV(pipeline, param_grid<span class="op">=</span>param_grid, </span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a>                           cv <span class="op">=</span> <span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'roc_auc'</span>)</span>
<span id="cb35-603"><a href="#cb35-603" aria-hidden="true" tabindex="-1"></a>    GSC.fit(X_train, y_train.values)</span>
<span id="cb35-604"><a href="#cb35-604" aria-hidden="true" tabindex="-1"></a>    hyperparameters.append(GSC.best_params_)</span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a>    best_scores.append(GSC.best_score_)</span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a>    estimator <span class="op">=</span> model</span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a>    tune_model(estimator, params[name])</span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-616"><a href="#cb35-616" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> hyperparameters:</span>
<span id="cb35-617"><a href="#cb35-617" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_scores)</span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>here we can see the hyperparameters chosen for the models and the best accuracy that was obtaind by those parameters. </span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Overall Logistic Regression model has performed most consistently during this analysis and that's the one we will use as the final model here</span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let's train a final model and test it on test set. </span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8. Final Training. </span></span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-630"><a href="#cb35-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-631"><a href="#cb35-631" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">"preprocesser"</span>, preprocessor),</span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a>                         (<span class="st">"outlier_rejection"</span>, </span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a>                          FunctionSampler(func<span class="op">=</span>outlier_rejection)),</span>
<span id="cb35-634"><a href="#cb35-634" aria-hidden="true" tabindex="-1"></a>                          (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb35-635"><a href="#cb35-635" aria-hidden="true" tabindex="-1"></a>                          (<span class="st">"LogisticRegression"</span>, </span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a>                          LogisticRegression(C<span class="op">=</span><span class="fl">0.1</span>, penalty<span class="op">=</span><span class="st">'l1'</span>,solver<span class="op">=</span><span class="st">'liblinear'</span>))])</span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-638"><a href="#cb35-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-639"><a href="#cb35-639" aria-hidden="true" tabindex="-1"></a>logreg.fit(X_train, y_train.values)</span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a>logreg.score(X_test, y_test.values)</span>
<span id="cb35-641"><a href="#cb35-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-642"><a href="#cb35-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally we can see the performance of our model on the test data</span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This doesnt tell us much though, let's look at some more metrics. </span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-648"><a href="#cb35-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-649"><a href="#cb35-649" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-650"><a href="#cb35-650" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yellowbrick.classifier <span class="im">import</span> ClassificationReport</span>
<span id="cb35-651"><a href="#cb35-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-652"><a href="#cb35-652" aria-hidden="true" tabindex="-1"></a>cr <span class="op">=</span> ClassificationReport(logreg, encoder<span class="op">=</span>{<span class="dv">0</span>:<span class="st">"No"</span>, <span class="dv">1</span>:<span class="st">"Yes"</span>})</span>
<span id="cb35-653"><a href="#cb35-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-654"><a href="#cb35-654" aria-hidden="true" tabindex="-1"></a>cr.fit(X_train, y_train.values)</span>
<span id="cb35-655"><a href="#cb35-655" aria-hidden="true" tabindex="-1"></a>cr.score(X_test, y_test.values)</span>
<span id="cb35-656"><a href="#cb35-656" aria-hidden="true" tabindex="-1"></a>cr.show()</span>
<span id="cb35-657"><a href="#cb35-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-658"><a href="#cb35-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-659"><a href="#cb35-659" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9. Final Thougts</span></span>
<span id="cb35-660"><a href="#cb35-660" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Logistic Regression and SVM machines achieved fairly similar results on the train set</span>
<span id="cb35-661"><a href="#cb35-661" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Logistic Regression is slightly better than SVM and seems like the best fit as the solution for GoalZone. </span>
<span id="cb35-662"><a href="#cb35-662" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The reason both of these models performed better than the K nearest neighbor is because they used linear decision boundaries. </span>
<span id="cb35-663"><a href="#cb35-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-666"><a href="#cb35-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-667"><a href="#cb35-667" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb35-668"><a href="#cb35-668" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yellowbrick.classifier <span class="im">import</span> class_prediction_error</span>
<span id="cb35-669"><a href="#cb35-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-670"><a href="#cb35-670" aria-hidden="true" tabindex="-1"></a>class_prediction_error(logreg, X_train, y_train.values, X_test, y_test.values, encoder<span class="op">=</span>{<span class="dv">0</span>:<span class="st">"No"</span>, <span class="dv">1</span>:<span class="st">"Yes"</span>})<span class="op">;</span></span>
<span id="cb35-671"><a href="#cb35-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-672"><a href="#cb35-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-673"><a href="#cb35-673" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>we can see prediction error for both of the classes here. </span>
<span id="cb35-674"><a href="#cb35-674" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Overall the model is performing better than just doing random guesses but It's hard to tell if it's really a significant difference. </span>
<span id="cb35-675"><a href="#cb35-675" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There should be more investigation done into this and different approaches need to be tried. </span>
<span id="cb35-676"><a href="#cb35-676" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This problem can also be looked at through the lens of time series and see if it's possible to predict class attendence over time. </span>
<span id="cb35-677"><a href="#cb35-677" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The data provided was very small in size and collecting more data with better features is also a good idea. </span>
<span id="cb35-678"><a href="#cb35-678" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this dataset there weren't a lot of features that explained the target variable well besides weight and Months_as_member</span>
<span id="cb35-679"><a href="#cb35-679" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If GoalZone wants to use this model for freeing up more seats for their classes about 65-75% seats can be freed according to the model. Again there might be some time series components here that need to be looked at but if you keep the prediction error in mind the business should be able to free up more seats.</span>
<span id="cb35-680"><a href="#cb35-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-681"><a href="#cb35-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-682"><a href="#cb35-682" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-683"><a href="#cb35-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-684"><a href="#cb35-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-685"><a href="#cb35-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-686"><a href="#cb35-686" aria-hidden="true" tabindex="-1"></a>**References**</span>
<span id="cb35-687"><a href="#cb35-687" aria-hidden="true" tabindex="-1"></a><span class="ss"> 1. </span><span class="co">[</span><span class="ot">datacamp</span><span class="co">](https://app.datacamp.com/)</span></span>
<span id="cb35-688"><a href="#cb35-688" aria-hidden="true" tabindex="-1"></a><span class="ss"> 2. </span><span class="co">[</span><span class="ot">pandas</span><span class="co">](https://pandas.pydata.org/)</span></span>
<span id="cb35-689"><a href="#cb35-689" aria-hidden="true" tabindex="-1"></a><span class="ss"> 3. </span><span class="co">[</span><span class="ot">Numpy</span><span class="co">](https://numpy.org/)</span></span>
<span id="cb35-690"><a href="#cb35-690" aria-hidden="true" tabindex="-1"></a><span class="ss"> 4. </span><span class="co">[</span><span class="ot">Scikit-learn</span><span class="co">](https://scikit-learn.org/stable/)</span></span>
<span id="cb35-691"><a href="#cb35-691" aria-hidden="true" tabindex="-1"></a><span class="ss"> 5. </span><span class="co">[</span><span class="ot">Matplotlib</span><span class="co">](https://matplotlib.org/)</span></span>
<span id="cb35-692"><a href="#cb35-692" aria-hidden="true" tabindex="-1"></a><span class="ss"> 6. </span><span class="co">[</span><span class="ot">Imbalanced-learn</span><span class="co">](https://imbalanced-learn.org/stable/)</span></span>
<span id="cb35-693"><a href="#cb35-693" aria-hidden="true" tabindex="-1"></a><span class="ss"> 7. </span><span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org/)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>